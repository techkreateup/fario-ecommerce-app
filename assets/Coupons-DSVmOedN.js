import{j as e}from"./framer-ClpLoJbl.js";import{r as l}from"./vendor-CSLgDR2_.js";import{s as i}from"./index-DKUMvhNP.js";import"./icons-D8yHJv9q.js";import"./supabase-CDGuCRB-.js";function E(){const[n,d]=l.useState([]),[b,p]=l.useState(!0),[h,u]=l.useState(null),[m,x]=l.useState(!1),[r,a]=l.useState({code:"",discounttype:"percentage",discountvalue:"",minordervalue:"",maxdiscount:"",usagelimit:""}),o=async()=>{console.log("ðŸ” Fetching coupons from Supabase..."),p(!0),u(null);try{const{data:s,error:t}=await i.from("coupons").select("*").order("createdat",{ascending:!1});t?(console.error("âŒ Supabase error:",t),u(t.message),d([])):(console.log("âœ… Coupons loaded:",s==null?void 0:s.length),d(s||[]))}catch(s){console.error("âŒ Catch error:",s),u(s.message),d([])}finally{p(!1)}};l.useEffect(()=>{o()},[]);const g=async s=>{if(s.preventDefault(),!r.code.trim()){alert("Coupon code is required!");return}try{const{error:t}=await i.from("coupons").insert([{code:r.code.toUpperCase().trim(),discounttype:r.discounttype,discountvalue:parseFloat(r.discountvalue)||0,minordervalue:parseFloat(r.minordervalue)||0,maxdiscount:r.maxdiscount?parseFloat(r.maxdiscount):null,usagelimit:r.usagelimit?parseInt(r.usagelimit):null,isactive:!0,usedcount:0}]);t?(console.error("Insert error:",t),alert("Error: "+t.message)):(alert("âœ… Coupon created successfully!"),x(!1),a({code:"",discounttype:"percentage",discountvalue:"",minordervalue:"",maxdiscount:"",usagelimit:""}),o())}catch(t){console.error("Catch error:",t),alert("Error: "+t.message)}},v=async(s,t)=>{try{const{error:c}=await i.from("coupons").update({isactive:!t}).eq("id",s);c?alert("Error: "+c.message):o()}catch(c){alert("Error: "+c.message)}},j=async s=>{if(confirm("Delete this coupon?"))try{const{error:t}=await i.from("coupons").delete().eq("id",s);t?alert("Error: "+t.message):(alert("Coupon deleted!"),o())}catch(t){alert("Error: "+t.message)}};return b?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading coupons..."})]})}):h?e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:[e.jsx("h3",{className:"font-bold",children:"Error Loading Coupons"}),e.jsx("p",{children:h}),e.jsx("button",{onClick:o,className:"mt-2 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Retry"})]})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"ðŸŽŸï¸ Coupons Management"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Total: ",n.length," | Active: ",n.filter(s=>s.isactive).length]})]}),e.jsx("button",{onClick:()=>x(!m),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition",children:m?"âœ• Cancel":"+ Create Coupon"})]}),m&&e.jsxs("form",{onSubmit:g,className:"bg-white p-6 rounded-lg shadow mb-6 border-2 border-blue-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Create New Coupon"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Coupon Code *"}),e.jsx("input",{type:"text",value:r.code,onChange:s=>a({...r,code:s.target.value.toUpperCase()}),className:"w-full border rounded px-3 py-2",placeholder:"SAVE20",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Discount Type *"}),e.jsxs("select",{value:r.discounttype,onChange:s=>a({...r,discounttype:s.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"percentage",children:"Percentage (%)"}),e.jsx("option",{value:"fixed",children:"Fixed Amount (â‚¹)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Discount Value *"}),e.jsx("input",{type:"number",value:r.discountvalue,onChange:s=>a({...r,discountvalue:s.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"20",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Min Order Value (â‚¹)"}),e.jsx("input",{type:"number",value:r.minordervalue,onChange:s=>a({...r,minordervalue:s.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"1000"})]}),r.discounttype==="percentage"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Max Discount (â‚¹)"}),e.jsx("input",{type:"number",value:r.maxdiscount,onChange:s=>a({...r,maxdiscount:s.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Usage Limit"}),e.jsx("input",{type:"number",value:r.usagelimit,onChange:s=>a({...r,usagelimit:s.target.value}),className:"w-full border rounded px-3 py-2",placeholder:"100"})]})]}),e.jsx("button",{type:"submit",className:"mt-4 bg-green-600 text-white px-8 py-2 rounded-lg hover:bg-green-700",children:"Create Coupon"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"No coupons created yet."}),e.jsx("button",{onClick:()=>x(!0),className:"mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"Create Your First Coupon"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Code"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Discount"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Min Order"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Usage"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-bold",children:s.code}),e.jsx("td",{className:"px-4 py-3",children:s.discounttype==="percentage"?`${s.discountvalue}%`:`â‚¹${s.discountvalue}`}),e.jsxs("td",{className:"px-4 py-3",children:["â‚¹",s.minordervalue]}),e.jsxs("td",{className:"px-4 py-3",children:[s.usedcount," / ",s.usagelimit||"âˆž"]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${s.isactive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.isactive?"ðŸŸ¢ Active":"ðŸ”´ Inactive"})}),e.jsxs("td",{className:"px-4 py-3 space-x-2",children:[e.jsx("button",{onClick:()=>v(s.id,s.isactive),className:"text-blue-600 hover:underline",children:s.isactive?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>j(s.id),className:"text-red-600 hover:underline",children:"Delete"})]})]},s.id))})]})})]})}export{E as default};
