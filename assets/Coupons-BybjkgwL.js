import{j as e}from"./framer-Bjzrnjch.js";import{r as n}from"./vendor-CSLgDR2_.js";import{s as c}from"./index-9V0LskCG.js";import"./icons-CZiLZLa-.js";import"./supabase-CDGuCRB-.js";function J(){const[l,j]=n.useState([]),[N,b]=n.useState(!0),[y,g]=n.useState(null),[u,m]=n.useState(!1),[d,f]=n.useState(null),[w,C]=n.useState("..."),[s,i]=n.useState({code:"",discounttype:"percentage",discountvalue:"",minordervalue:"",maxdiscount:"",usagelimit:"",validuntil:""});n.useEffect(()=>{c.auth.getUser().then(({data:t})=>{t.user&&C(t.user.id.slice(0,8))})},[]);const o=async()=>{try{g(null),console.log("ðŸ“¡ [AdminCoupons] Fetching via Native Fetch (GET Strategy)...");const r="https://csyiiksxpmbehiiovlbg.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNzeWlpa3N4cG1iZWhpaW92bGJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNTE1MDgsImV4cCI6MjA4NjYyNzUwOH0.A1i9vqFwd_BsMwtod_uFyR-yJhHGW2Vu7PmacxGT6m4",A=`${r}/rest/v1/content_manifests?select=*&order=createdat.desc`,v=new AbortController,D=setTimeout(()=>v.abort(),15e3),x=await fetch(A,{method:"GET",headers:{apikey:a,Authorization:`Bearer ${a}`,"Content-Type":"application/json"},signal:v.signal});if(clearTimeout(D),!x.ok)throw new Error(`HTTP Error: ${x.status} ${x.statusText}`);const p=await x.json();console.log("âœ… [AdminCoupons] Manifest loaded (Native):",p==null?void 0:p.length),j(p||[])}catch(r){console.error("âŒ [AdminCoupons] Error fetching view:",r),r.name==="AbortError"?g("Request timed out after 15000ms"):g(r.message||"Unknown error occurred")}finally{b(!1)}};n.useEffect(()=>{o()},[]),n.useEffect(()=>{const t=setInterval(o,1e4);return()=>clearInterval(t)},[]);const h=()=>{i({code:"",discounttype:"percentage",discountvalue:"",minordervalue:"",maxdiscount:"",usagelimit:"",validuntil:""}),f(null),m(!1)},E=async t=>{if(t.preventDefault(),!s.code.trim()){alert("Coupon code is required!");return}if(!s.discountvalue||parseFloat(s.discountvalue)<=0){alert("Discount value must be greater than 0!");return}try{const r={code:s.code.toUpperCase().trim(),discounttype:s.discounttype,discountvalue:parseFloat(s.discountvalue),minordervalue:parseFloat(s.minordervalue)||0,maxdiscount:s.maxdiscount?parseFloat(s.maxdiscount):null,usagelimit:s.usagelimit?parseInt(s.usagelimit):null,validuntil:s.validuntil||null,isactive:!0};if(d){const{error:a}=await c.from("coupons").update(r).eq("id",d.id);if(a)throw a;alert("âœ… Coupon updated successfully!")}else{const{error:a}=await c.from("coupons").insert([{...r,usedcount:0}]);if(a)throw a;alert("âœ… Coupon created successfully!")}h(),o()}catch(r){console.error("âŒ Error saving coupon:",r),r.code==="23505"?alert("Coupon code already exists!"):alert("Error: "+r.message)}},k=t=>{var r,a;f(t),i({code:t.code,discounttype:t.discounttype,discountvalue:t.discountvalue.toString(),minordervalue:t.minordervalue.toString(),maxdiscount:((r=t.maxdiscount)==null?void 0:r.toString())||"",usagelimit:((a=t.usagelimit)==null?void 0:a.toString())||"",validuntil:t.validuntil||""}),m(!0)},I=async(t,r)=>{try{const{error:a}=await c.from("coupons").update({isactive:!r}).eq("id",t);if(a)throw a;o()}catch(a){alert("Error: "+a.message)}},S=async t=>{if(confirm("Are you sure you want to delete this coupon?"))try{const{error:r}=await c.from("coupons").delete().eq("id",t);if(r)throw r;alert("Coupon deleted!"),o()}catch(r){alert("Error: "+r.message)}};return N&&l.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading coupons..."})]})}):y&&l.length===0?e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-lg shadow-sm",children:[e.jsx("h3",{className:"font-bold flex items-center gap-2",children:"âš ï¸ Error Loading Coupons"}),e.jsx("p",{className:"mt-2",children:y}),e.jsx("button",{onClick:()=>{b(!0),o()},className:"mt-4 bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition",children:"Retry Connection"})]})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto font-sans",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"ðŸŽŸï¸ Coupons Management"}),e.jsxs("div",{className:"flex gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"bg-gray-100 px-2 py-1 rounded",children:["Total: ",l.length]}),e.jsxs("span",{className:"bg-green-50 text-green-700 px-2 py-1 rounded",children:["Active: ",l.filter(t=>t.isactive).length]}),e.jsxs("span",{className:"bg-blue-50 text-blue-700 px-2 py-1 rounded",children:["Redeemed: ",l.reduce((t,r)=>t+r.usedcount,0)]})]})]}),e.jsx("button",{onClick:()=>{h(),m(!u)},className:`px-6 py-2.5 rounded-lg font-medium transition shadow-sm ${u?"bg-gray-200 text-gray-800 hover:bg-gray-300":"bg-blue-600 text-white hover:bg-blue-700"}`,children:u?"âœ• Cancel":"+ Create Coupon"})]}),u&&e.jsxs("form",{onSubmit:E,className:"bg-white p-6 rounded-xl shadow-lg mb-8 border border-gray-100 animate-in slide-in-from-top-4 duration-200",children:[e.jsx("div",{className:"flex justify-between items-center mb-6 border-b pb-4",children:e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:d?"Edit Coupon":"Create New Coupon"})}),e.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Coupon Code *"}),e.jsx("input",{type:"text",value:s.code,onChange:t=>i({...s,code:t.target.value.toUpperCase()}),className:"w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none uppercase font-mono tracking-wide",placeholder:"SAVE20",required:!0,disabled:!!d})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Discount Type *"}),e.jsxs("select",{value:s.discounttype,onChange:t=>i({...s,discounttype:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none bg-white",children:[e.jsx("option",{value:"percentage",children:"Percentage (%)"}),e.jsx("option",{value:"fixed",children:"Fixed Amount (â‚¹)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 font-semibold text-gray-700",children:["Discount Value * ",s.discounttype==="percentage"?"(%)":"(â‚¹)"]}),e.jsx("input",{type:"number",value:s.discountvalue,onChange:t=>i({...s,discountvalue:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none",min:"0",step:"0.01",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Min Order Value (â‚¹)"}),e.jsx("input",{type:"number",value:s.minordervalue,onChange:t=>i({...s,minordervalue:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none",min:"0",placeholder:"0"})]}),s.discounttype==="percentage"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Max Discount (â‚¹)"}),e.jsx("input",{type:"number",value:s.maxdiscount,onChange:t=>i({...s,maxdiscount:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none",min:"0",placeholder:"Optional"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Usage Limit"}),e.jsx("input",{type:"number",value:s.usagelimit,onChange:t=>i({...s,usagelimit:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none",min:"1",placeholder:"Unlimited"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold text-gray-700",children:"Valid Until"}),e.jsx("input",{type:"datetime-local",value:s.validuntil,onChange:t=>i({...s,validuntil:t.target.value}),className:"w-full border border-gray-300 rounded-lg px-4 py-2.5 focus:ring-2 focus:ring-blue-500 outline-none"})]})]}),e.jsxs("div",{className:"mt-8 flex gap-3 border-t pt-6",children:[e.jsx("button",{type:"submit",className:"bg-green-600 text-white px-8 py-2.5 rounded-lg hover:bg-green-700 font-medium transition shadow-sm",children:d?"Update Coupon":"Create Coupon"}),e.jsx("button",{type:"button",onClick:h,className:"bg-gray-100 text-gray-700 px-8 py-2.5 rounded-lg hover:bg-gray-200 font-medium transition",children:"Cancel"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:l.length===0?e.jsxs("div",{className:"text-center py-16 bg-gray-50/50",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸŽ«"}),e.jsx("p",{className:"text-gray-500 text-lg font-medium",children:"No coupons created yet"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1 mb-6",children:"Create your first coupon to get started"}),e.jsx("button",{onClick:()=>m(!0),className:"bg-blue-600 text-white px-6 py-2.5 rounded-lg hover:bg-blue-700 font-medium shadow-sm transition",children:"Create Coupon"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Code"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Discount"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Min Order"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Usage"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Expiry"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:l.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50/80 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"font-mono font-bold text-gray-900 bg-gray-100 px-2 py-1 rounded text-sm",children:t.code})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t.discounttype==="percentage"?`${t.discountvalue}%`:`â‚¹${t.discountvalue}`}),t.maxdiscount&&t.discounttype==="percentage"&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Max off: â‚¹",t.maxdiscount]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-gray-600",children:["â‚¹",t.minordervalue]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium text-gray-900",children:t.usedcount}),e.jsx("span",{className:"text-gray-400 mx-1",children:"/"}),t.usagelimit||"âˆž"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:t.validuntil?new Date(t.validuntil).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):e.jsx("span",{className:"text-gray-400",children:"Never"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.isactive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isactive?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>k(t),className:"text-blue-600 hover:text-blue-900 hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>I(t.id,t.isactive),className:`${t.isactive?"text-orange-600 hover:text-orange-900":"text-green-600 hover:text-green-900"} hover:underline`,children:t.isactive?"Disable":"Enable"}),e.jsx("button",{onClick:()=>S(t.id),className:"text-red-600 hover:text-red-900 hover:underline",children:"Delete"})]})})]},t.id))})]})})}),e.jsxs("div",{className:"mt-6 flex items-center justify-between text-xs text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),"Live Sync Active (10s)"]}),e.jsxs("div",{children:["Admin ID: ",w]})]})]})}export{J as default};
