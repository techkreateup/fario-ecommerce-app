import{j as e}from"./framer-ClpLoJbl.js";import{r as o}from"./vendor-CSLgDR2_.js";import{s as r}from"./index-BR59E-w0.js";import"./icons-D8yHJv9q.js";import"./supabase-CDGuCRB-.js";function C(){const[i,p]=o.useState([]),[x,u]=o.useState(!0),[d,m]=o.useState(!1),[s,a]=o.useState({code:"",discounttype:"percentage",discountvalue:"",minordervalue:0,maxdiscount:"",usagelimit:"",validuntil:""}),n=async()=>{try{u(!0);const{data:t,error:l}=await r.from("coupons").select("*").order("createdat",{ascending:!1});if(l)throw l;p(t||[]),console.log("âœ… Coupons loaded:",t==null?void 0:t.length)}catch(t){console.error("âŒ Error fetching coupons:",t),alert("Failed to load coupons: "+t.message)}finally{u(!1)}};o.useEffect(()=>{n();const t=r.channel("coupons-channel").on("postgres_changes",{event:"*",schema:"public",table:"coupons"},l=>{console.log("ðŸ”” Real-time update:",l),n()}).subscribe();return()=>{r.removeChannel(t)}},[]);const h=async t=>{if(t.preventDefault(),!s.code.trim()){alert("Coupon code is required");return}try{const{error:l}=await r.from("coupons").insert({code:s.code.toUpperCase(),discounttype:s.discounttype,discountvalue:parseFloat(s.discountvalue),minordervalue:parseFloat(s.minordervalue.toString())||0,maxdiscount:s.maxdiscount?parseFloat(s.maxdiscount):null,usagelimit:s.usagelimit?parseInt(s.usagelimit):null,validuntil:s.validuntil||null,isactive:!0,usedcount:0});if(l)throw l;alert("âœ… Coupon created successfully!"),m(!1),a({code:"",discounttype:"percentage",discountvalue:"",minordervalue:0,maxdiscount:"",usagelimit:"",validuntil:""}),n()}catch(l){console.error("âŒ Error creating coupon:",l),l.code==="23505"?alert("Coupon code already exists!"):alert("Failed to create coupon: "+l.message)}},g=async(t,l)=>{try{const{error:c}=await r.from("coupons").update({isactive:!l,updatedat:new Date().toISOString()}).eq("id",t);if(c)throw c;console.log("âœ… Coupon status toggled"),n()}catch(c){console.error("âŒ Error toggling status:",c),alert("Failed to update status")}},b=async t=>{if(confirm("Are you sure you want to delete this coupon?"))try{const{error:l}=await r.from("coupons").delete().eq("id",t);if(l)throw l;console.log("âœ… Coupon deleted"),n()}catch(l){console.error("âŒ Error deleting coupon:",l),alert("Failed to delete coupon")}};return x?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"text-xl",children:"Loading coupons..."})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"ðŸŽŸï¸ Coupons Management"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["Total Coupons: ",i.length," | Active: ",i.filter(t=>t.isactive).length]})]}),e.jsx("button",{onClick:()=>m(!d),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition",children:d?"âœ• Cancel":"+ Create Coupon"})]}),d&&e.jsxs("form",{onSubmit:h,className:"bg-white p-6 rounded-lg shadow-lg mb-6 border-2 border-blue-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Create New Coupon"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Coupon Code *"}),e.jsx("input",{type:"text",value:s.code,onChange:t=>a({...s,code:t.target.value.toUpperCase()}),className:"w-full border rounded px-3 py-2 uppercase",placeholder:"SAVE20",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Discount Type *"}),e.jsxs("select",{value:s.discounttype,onChange:t=>a({...s,discounttype:t.target.value}),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"percentage",children:"Percentage (%)"}),e.jsx("option",{value:"fixed",children:"Fixed Amount (â‚¹)"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block mb-2 font-semibold",children:["Discount Value * ",s.discounttype==="percentage"?"(%)":"(â‚¹)"]}),e.jsx("input",{type:"number",value:s.discountvalue,onChange:t=>a({...s,discountvalue:t.target.value}),className:"w-full border rounded px-3 py-2",min:"0",step:"0.01",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Minimum Order Value (â‚¹)"}),e.jsx("input",{type:"number",value:s.minordervalue,onChange:t=>a({...s,minordervalue:Number(t.target.value)}),className:"w-full border rounded px-3 py-2",min:"0"})]}),s.discounttype==="percentage"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Max Discount (â‚¹)"}),e.jsx("input",{type:"number",value:s.maxdiscount,onChange:t=>a({...s,maxdiscount:t.target.value}),className:"w-full border rounded px-3 py-2",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Usage Limit"}),e.jsx("input",{type:"number",value:s.usagelimit,onChange:t=>a({...s,usagelimit:t.target.value}),className:"w-full border rounded px-3 py-2",min:"1",placeholder:"Leave empty for unlimited"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-semibold",children:"Valid Until"}),e.jsx("input",{type:"datetime-local",value:s.validuntil,onChange:t=>a({...s,validuntil:t.target.value}),className:"w-full border rounded px-3 py-2"})]})]}),e.jsx("button",{type:"submit",className:"mt-4 bg-green-600 text-white px-8 py-2 rounded-lg hover:bg-green-700 transition",children:"âœ… Create Coupon"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Code"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Discount"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Min Order"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Usage"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Valid Until"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-8 text-gray-500",children:'No coupons created yet. Click "+ Create Coupon" to add one.'})}):i.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-bold",children:t.code}),e.jsx("td",{className:"px-4 py-3",children:t.discounttype==="percentage"?`${t.discountvalue}%`:`â‚¹${t.discountvalue}`}),e.jsxs("td",{className:"px-4 py-3",children:["â‚¹",t.minordervalue]}),e.jsxs("td",{className:"px-4 py-3",children:[t.usedcount," / ",t.usagelimit||"âˆž"]}),e.jsx("td",{className:"px-4 py-3",children:t.validuntil?new Date(t.validuntil).toLocaleDateString():"No expiry"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs ${t.isactive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isactive?"ðŸŸ¢ Active":"ðŸ”´ Inactive"})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("button",{onClick:()=>g(t.id,t.isactive),className:"text-blue-600 hover:underline mr-3",children:t.isactive?"Deactivate":"Activate"}),e.jsx("button",{onClick:()=>b(t.id),className:"text-red-600 hover:underline",children:"Delete"})]})]},t.id))})]})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Real-time updates enabled"]})]})}export{C as default};
