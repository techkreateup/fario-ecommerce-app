import{j as e,m as S}from"./framer-ClpLoJbl.js";import{r as i}from"./vendor-CSLgDR2_.js";import{s as u,l as g}from"./index-CsRHpIul.js";import{i as A,a0 as N,R as w,o as b,ak as z,N as j,aB as _,r as L,aQ as I,$ as q}from"./icons-D8yHJv9q.js";import"./supabase-CDGuCRB-.js";const B=()=>{const[d,c]=i.useState([]),[v,h]=i.useState(!0),[l,n]=i.useState(null),[o,y]=i.useState(""),[x,k]=i.useState("all"),p=async()=>{h(!0);try{const{data:t,error:a}=await u.from("returns").select("*, orders!inner(userEmail, total)").order("requestedat",{ascending:!1});if(a)throw a;const r=(t||[]).map(s=>({...s,requestedAt:s.requestedat||s.requestedAt,refundAmount:s.refundamount||s.refundAmount||0,orderId:s.orderid||s.orderId,status:s.status,method:s.method}));c(r)}catch(t){console.error("Error fetching returns:",t)}finally{h(!1)}};i.useEffect(()=>{p()},[]);const m=async(t,a,r)=>{n(t);try{const{error:s}=await u.from("returns").update({status:a,decision_reason:r,decided_at:new Date().toISOString(),auto_decision:!1}).eq("id",t);if(s)throw s;await g(a==="approved"?"return_approved":"return_rejected",{return_id:t,reason:r}),await p()}catch(s){console.error("Decision error:",s)}finally{n(null)}},C=async t=>{n(t.id);try{const{error:a}=await u.rpc("process_return_refund",{return_id:t.id});if(a)throw a;await g("return_refunded",{return_id:t.id,amount:t.refundAmount,method:t.method}),await p()}catch(a){console.error("Refund error:",a),alert("Refund failed: "+a.message)}finally{n(null)}},f=d.filter(t=>{const a=t.id.toLowerCase().includes(o.toLowerCase())||t.orders.userEmail.toLowerCase().includes(o.toLowerCase()),r=x==="all"||t.status.toLowerCase()===x.toLowerCase();return a&&r}),R=t=>{switch(t.toLowerCase()){case"approved":return e.jsx(q,{size:16,className:"text-green-500"});case"rejected":return e.jsx(I,{size:16,className:"text-red-500"});case"refunded":return e.jsx(b,{size:16,className:"text-blue-500"});default:return e.jsx(L,{size:16,className:"text-amber-500"})}};return e.jsxs("div",{className:"space-y-8 pb-20",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-black font-heading italic tracking-tighter text-white leading-none",children:"Returns & RMA"}),e.jsx("p",{className:"text-white/50 text-sm mt-2 font-medium",children:"Manage product return requests and automated decisions."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/30",size:16}),e.jsx("input",{type:"text",placeholder:"Search Return/Order ID...",value:o,onChange:t=>y(t.target.value),className:"bg-white/5 border border-white/10 rounded-xl pl-10 pr-4 py-2.5 text-sm text-white focus:outline-none focus:ring-2 focus:ring-fario-purple transition-all w-64 shadow-inner"})]}),e.jsxs("select",{value:x,onChange:t=>k(t.target.value),className:"bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-sm text-white focus:outline-none focus:ring-2 focus:ring-fario-purple transition-all shadow-inner",children:[e.jsx("option",{value:"all",className:"bg-slate-900",children:"All Status"}),e.jsx("option",{value:"pending",className:"bg-slate-900",children:"Pending"}),e.jsx("option",{value:"approved",className:"bg-slate-900",children:"Approved"}),e.jsx("option",{value:"refunded",className:"bg-slate-900",children:"Refunded"}),e.jsx("option",{value:"rejected",className:"bg-slate-900",children:"Rejected"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:v?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(N,{className:"text-fario-purple animate-spin",size:48})}):f.length===0?e.jsxs("div",{className:"bg-white/5 backdrop-blur-md rounded-[2.5rem] border border-white/10 p-20 text-center",children:[e.jsx(w,{size:64,className:"mx-auto text-white/10 mb-6"}),e.jsx("h3",{className:"text-2xl font-bold text-white uppercase italic",children:"No Returns Logged"}),e.jsx("p",{className:"text-white/40 max-w-xs mx-auto mt-2",children:"All product lifecycles are currently within healthy operational parameters."})]}):f.map(t=>e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"group relative bg-white/5 backdrop-blur-xl rounded-[2rem] border border-white/10 p-6 hover:bg-white/[0.07] transition-all overflow-hidden",children:[t.auto_decision&&e.jsxs("div",{className:"absolute top-0 right-10 transform -translate-y-1/2 bg-fario-purple text-white text-[10px] font-black uppercase tracking-widest px-4 py-1.5 rounded-full shadow-lg flex items-center gap-2",children:[e.jsx(b,{size:12})," Auto-Decided"]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-white/5 rounded-2xl flex items-center justify-center border border-white/10 group-hover:border-fario-purple/30 transition-colors",children:e.jsx(w,{size:24,className:"text-white/40 group-hover:text-fario-purple transition-colors"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] font-black text-white/30 uppercase tracking-[0.2em]",children:["Request ID: ",t.id]}),e.jsxs("h3",{className:"text-xl font-black text-white italic tracking-tight",children:["Order #",t.orderId]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-1.5 rounded-full border border-white/10 bg-white/5",children:[R(t.status),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-white/70",children:t.status})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 py-4 border-y border-white/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Customer"}),e.jsx("p",{className:"text-sm font-bold text-white/80 truncate",children:t.orders.userEmail})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Refund Method"}),e.jsxs("div",{className:"flex items-center gap-2 text-white/80",children:[t.method==="credit"?e.jsx(z,{size:14,className:"text-fario-purple"}):e.jsx(j,{size:14,className:"text-fario-purple"}),e.jsx("span",{className:"text-sm font-bold uppercase",children:t.method})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Requested Value"}),e.jsxs("p",{className:"text-sm font-black text-white italic",children:["â‚¹",t.refundAmount.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Time Elapsed"}),e.jsx("p",{className:"text-sm font-bold text-white/60",children:new Date(t.requestedAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-[10px] font-black text-white/30 uppercase tracking-widest",children:"Customer Insight"}),e.jsxs("div",{className:"p-4 bg-black/20 rounded-xl border border-white/5 italic text-white/70 text-sm leading-relaxed",children:['"',t.reason,'"']})]})]}),e.jsxs("div",{className:"lg:w-80 flex flex-col gap-4",children:[e.jsxs("div",{className:"flex-grow p-5 bg-fario-purple/5 rounded-2xl border border-fario-purple/10",children:[e.jsxs("h4",{className:"text-[10px] font-black text-fario-purple uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(_,{size:12})," System Status"]}),e.jsx("p",{className:"text-xs text-white/60 font-medium leading-relaxed",children:t.decision_reason||"Awaiting manual triage by HQ staff."})]}),e.jsx("div",{className:"flex gap-2",children:t.status==="pending_review"||t.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(t.id,"approved","Approved by Admin"),disabled:!!l,className:"flex-1 bg-green-500 hover:bg-green-600 text-white font-black uppercase text-[10px] tracking-widest py-3 rounded-xl transition-all shadow-lg shadow-green-500/10 disabled:opacity-50",children:"Approve"}),e.jsx("button",{onClick:()=>m(t.id,"rejected","Rejected by Admin"),disabled:!!l,className:"flex-1 bg-red-500/20 hover:bg-red-500/30 text-red-500 border border-red-500/30 font-black uppercase text-[10px] tracking-widest py-3 rounded-xl transition-all disabled:opacity-50",children:"Reject"})]}):t.status==="approved"?e.jsxs("button",{onClick:()=>C(t),disabled:!!l,className:"w-full bg-fario-purple hover:bg-fario-purple-dark text-white font-black uppercase text-[10px] tracking-widest py-3 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2 disabled:opacity-50",children:[l===t.id?e.jsx(E,{className:"animate-spin",size:14}):e.jsx(j,{size:14}),"Execute Refund"]}):e.jsx("div",{className:"w-full px-4 py-3 bg-white/5 border border-white/10 rounded-xl text-center",children:e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-white/30 italic",children:"Processing Complete"})})})]})]})]},t.id))})]})},E=({className:d,size:c})=>e.jsx(N,{className:d,size:c});export{B as default};
