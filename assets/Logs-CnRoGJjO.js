import{j as e}from"./framer-ClpLoJbl.js";import{r as l}from"./vendor-CSLgDR2_.js";import{s as A}from"./index-rOa9hfUT.js";import{i as S,aC as _,a0 as z,_ as L,U as E,W as T,a1 as $,n as D}from"./icons-D8yHJv9q.js";import"./supabase-CDGuCRB-.js";const F=()=>{const[x,N]=l.useState([]),[m,p]=l.useState(!0),[i,v]=l.useState(""),[d,w]=l.useState("all"),[a,h]=l.useState(1),[c,y]=l.useState(0),r=15,u=async()=>{p(!0);try{let s=A.from("logs").select(`
          *,
          profiles:user_id (name, email)
        `,{count:"exact"});d!=="all"&&(s=s.eq("action",d)),i&&(s=s.or(`action.ilike.%${i}%, details->>email.ilike.%${i}%`));const{data:t,count:o,error:n}=await s.order("created_at",{ascending:!1}).range((a-1)*r,a*r-1);if(n)throw n;N(t||[]),y(o||0)}catch(s){console.error("Error fetching logs:",s)}finally{p(!1)}};l.useEffect(()=>{u()},[a,d,i]);const k=s=>{const t="px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest border";return s.includes("error")||s.includes("delete")||s.includes("rejected")?`${t} text-rose-600 bg-rose-50 border-rose-100`:s.includes("add")||s.includes("create")||s.includes("place")||s.includes("approved")||s.includes("login")?`${t} text-emerald-600 bg-emerald-50 border-emerald-100`:s.includes("update")||s.includes("change")?`${t} text-sky-600 bg-sky-50 border-sky-100`:`${t} text-slate-500 bg-slate-50 border-slate-100`},C=s=>new Date(s).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"space-y-8 animate-slide-up",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"admin-h1",children:"Audit Logs"}),e.jsx("p",{className:"admin-subtitle",children:"Comprehensive system activity and transaction ledger."})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(S,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search log entries...",value:i,onChange:s=>v(s.target.value),className:"admin-input pl-10 w-64 shadow-sm"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white border border-slate-200 rounded-xl px-2 py-1 shadow-sm",children:[e.jsx(_,{size:14,className:"text-slate-400 ml-2"}),e.jsxs("select",{value:d,onChange:s=>w(s.target.value),className:"bg-transparent border-none py-1.5 pl-1 pr-8 text-xs font-bold text-slate-600 focus:ring-0 outline-none cursor-pointer",children:[e.jsx("option",{value:"all",children:"All Events"}),e.jsx("option",{value:"user_login",children:"Logins"}),e.jsx("option",{value:"order_placed",children:"Orders"}),e.jsx("option",{value:"wallet_credit",children:"Wallet Credits"}),e.jsx("option",{value:"wallet_debit",children:"Wallet Debits"}),e.jsx("option",{value:"return_requested",children:"Returns"})]})]}),e.jsx("button",{onClick:()=>u(),className:"p-2.5 bg-white border border-slate-200 rounded-xl text-slate-400 hover:text-fario-purple hover:bg-slate-50 transition-all shadow-sm",title:"Refresh Logs",children:e.jsx(z,{size:18,className:m?"animate-spin":""})})]})]}),e.jsxs("div",{className:"admin-table-container",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"admin-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-48",children:"Event Timestamp"}),e.jsx("th",{className:"w-40",children:"Classification"}),e.jsx("th",{className:"w-64",children:"Origin / User"}),e.jsx("th",{children:"Transaction Context"})]})}),e.jsx("tbody",{children:m?Array(5).fill(0).map((s,t)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-slate-50 rounded w-32"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-6 bg-slate-50 rounded-lg w-24"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-slate-50 rounded w-40"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-slate-50 rounded w-3/4"})})]},t)):x.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"px-6 py-20 text-center",children:[e.jsx(L,{size:48,className:"mx-auto text-slate-100 mb-4"}),e.jsx("p",{className:"text-slate-400 font-bold uppercase text-[10px] tracking-widest",children:"No matching activities record found"})]})}):x.map(s=>{var t,o,n,j,b;return e.jsxs("tr",{className:"hover:bg-slate-50/50 transition-colors group",children:[e.jsx("td",{className:"whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-900",children:C(s.created_at)}),e.jsxs("span",{className:"text-[10px] text-slate-300 font-mono mt-0.5",children:["#",s.id.slice(0,8)]})]})}),e.jsx("td",{children:e.jsx("span",{className:k(s.action),children:s.action.replace(/_/g," ")})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-900 flex items-center justify-center text-[10px] font-black text-white uppercase shadow-sm",children:((o=(t=s.profiles)==null?void 0:t.name)==null?void 0:o.charAt(0))||((n=s.profiles)==null?void 0:n.email.charAt(0))||e.jsx(E,{size:12})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-bold text-slate-900",children:((j=s.profiles)==null?void 0:j.name)||"Authorized Guest"}),e.jsx("span",{className:"text-[10px] text-slate-400 font-medium truncate max-w-[150px]",children:(b=s.profiles)==null?void 0:b.email})]})]})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-1.5 max-w-md",children:[Object.entries(s.details||{}).slice(0,3).map(([f,g])=>e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-slate-50 rounded border border-slate-100",children:[e.jsxs("span",{className:"text-[9px] font-black text-slate-400 uppercase",children:[f,":"]}),e.jsx("span",{className:"text-[10px] font-bold text-slate-600 truncate max-w-[120px]",children:typeof g=="object"?"DATA":String(g)})]},f)),Object.keys(s.details||{}).length>3&&e.jsxs("span",{className:"text-[10px] text-slate-300 font-bold italic",children:["+",Object.keys(s.details).length-3," insights"]})]}),e.jsx("button",{className:"text-slate-300 hover:text-fario-purple transition-all p-1.5 hover:bg-white rounded-lg opacity-0 group-hover:opacity-100 shadow-sm border border-transparent hover:border-slate-100",children:e.jsx(T,{size:16})})]})})]},s.id)})})]})}),e.jsxs("div",{className:"px-6 py-4 bg-slate-50/50 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:["Displaying ",e.jsxs("span",{className:"text-slate-900",children:[(a-1)*r+1," â€” ",Math.min(a*r,c)]})," of ",e.jsx("span",{className:"text-slate-900",children:c})," entries"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>h(s=>Math.max(1,s-1)),disabled:a===1,className:"p-2 bg-white border border-slate-200 rounded-lg text-slate-600 disabled:opacity-30 hover:bg-slate-50 hover:text-fario-purple transition-all shadow-sm",children:e.jsx($,{size:16})}),e.jsx("div",{className:"bg-white border border-slate-200 rounded-lg px-4 py-1.5 shadow-sm",children:e.jsxs("span",{className:"text-xs font-black text-slate-900",children:["Page ",a]})}),e.jsx("button",{onClick:()=>h(s=>s*r<c?s+1:s),disabled:a*r>=c,className:"p-2 bg-white border border-slate-200 rounded-lg text-slate-600 disabled:opacity-30 hover:bg-slate-50 hover:text-fario-purple transition-all shadow-sm",children:e.jsx(D,{size:16})})]})]})]})]})};export{F as default};
