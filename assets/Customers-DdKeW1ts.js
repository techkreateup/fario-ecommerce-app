const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DYlR4Og9.js","assets/framer-ClpLoJbl.js","assets/vendor-CSLgDR2_.js","assets/icons-D8yHJv9q.js","assets/supabase-CDGuCRB-.js","assets/index-Yhu5IcuS.css"])))=>i.map(i=>d[i]);
import{_ as v}from"./index-DYlR4Og9.js";import{m as F,j as e,A as y}from"./framer-ClpLoJbl.js";import{r as n}from"./vendor-CSLgDR2_.js";import{az as V,_ as R,aF as O,aG as q,aH as M,i as G,aI as H,d as S,v as A,W as J,a7 as W,X as _}from"./icons-D8yHJv9q.js";import"./supabase-CDGuCRB-.js";const X=o=>o>5e4?"Platinum":o>1e4?"Gold":"Standard",te=()=>{const[o,b]=n.useState([]),[B,w]=n.useState(!0);n.useEffect(()=>{(async()=>{w(!0);try{const{supabase:s}=await v(async()=>{const{supabase:r}=await import("./index-DYlR4Og9.js").then(d=>d.c);return{supabase:r}},__vite__mapDeps([0,1,2,3,4,5])),{data:l,error:a}=await s.from("customer_stats_view").select("*");if(a)throw a;const c=(l||[]).map(r=>({id:r.id,name:r.name||"Unknown",email:r.email||"No Email",phone:r.phone||"No Phone",totalSpent:r.total_spent||0,orders:r.order_count||0,status:"Active",joined:new Date(r.joined||Date.now()).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),tier:X(r.total_spent||0)}));b(c)}catch(s){console.error("Failed to load customers:",s)}finally{w(!1)}})()},[]);const[m,E]=n.useState(""),[p,P]=n.useState("All"),[L,h]=n.useState(!1),[i,g]=n.useState(null),[N,f]=n.useState(!1),[x,j]=n.useState({name:"",email:"",phone:""}),z=n.useMemo(()=>{const t=o.length,s=o.filter(d=>d.status==="Active").length,l=o.reduce((d,U)=>d+U.totalSpent,0),a=t>0?l/t:0,c=o.filter(d=>d.totalSpent>1e4).length,r=t>0?Math.round(c/t*100):0;return[{label:"Total Customers",value:t,sub:"Registered Accounts",icon:V,color:"text-blue-600",bg:"bg-blue-50"},{label:"Active Users",value:s,sub:"Currently Active",icon:R,color:"text-emerald-600",bg:"bg-emerald-50"},{label:"Avg LTV",value:`₹${a.toFixed(0)}`,sub:"Revenue Per User",icon:O,color:"text-fario-purple",bg:"bg-fario-purple/5"},{label:"High Value %",value:`${r}%`,sub:"Spend > 10k",icon:q,color:"text-amber-600",bg:"bg-amber-50"}]},[o]),k=n.useMemo(()=>o.filter(t=>{const s=t.name.toLowerCase().includes(m.toLowerCase())||t.email.toLowerCase().includes(m.toLowerCase())||t.id.toLowerCase().includes(m.toLowerCase()),l=p==="All"||t.status===p;return s&&l}),[o,m,p]);n.useEffect(()=>{let t,s;return(async()=>{const{supabase:a}=await v(async()=>{const{supabase:c}=await import("./index-DYlR4Og9.js").then(r=>r.c);return{supabase:c}},__vite__mapDeps([0,1,2,3,4,5]));s=a,t=a.channel("customer_changes").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},()=>{window.location.reload()}).subscribe()})(),()=>{t&&s&&s.removeChannel(t)}},[]);const C=async t=>{if(window.confirm("CRITICAL: Purge this identity from the global registry? Action is irreversible."))try{const{supabase:s}=await v(async()=>{const{supabase:a}=await import("./index-DYlR4Og9.js").then(c=>c.c);return{supabase:a}},__vite__mapDeps([0,1,2,3,4,5])),{error:l}=await s.from("profiles").delete().eq("id",t);if(l)throw l;b(a=>a.filter(c=>c.id!==t)),(i==null?void 0:i.id)===t&&g(null)}catch(s){console.error("Failed to delete customer:",s),alert("Failed to delete customer. Ensure no dependent orders exist.")}},T=async t=>{alert('Status toggling requires "status" column in profiles table. Only local state updated for now.'),b(s=>s.map(l=>{if(l.id===t){const a=l.status==="Active"?"Suspended":"Active";return{...l,status:a}}return l}))},D=async t=>{t.preventDefault(),f(!0);try{alert("Note: Creating a customer manually usually requires an associated Auth Account. This feature is limited in client-side admin panels."),f(!1),h(!1)}catch(s){console.error(s),f(!1)}},I=()=>{const t=`data:text/csv;charset=utf-8,ID,Name,Email,Phone,Total Spent,Orders,Status
`+o.map(a=>`${a.id},${a.name},${a.email},${a.phone},${a.totalSpent},${a.orders},${a.status}`).join(`
`),s=encodeURI(t),l=document.createElement("a");l.setAttribute("href",s),l.setAttribute("download","fario_customers_registry.csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l)},$=(t="Standard")=>{switch(t){case"Platinum":return"bg-fario-purple text-white";case"Gold":return"bg-amber-100 text-amber-700";default:return"bg-gray-100 text-gray-600"}},u=F.div;return e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500 pb-24 max-w-7xl mx-auto px-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-6 pt-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-fario-purple"}),e.jsx("p",{className:"text-[10px] font-bold uppercase tracking-widest text-fario-purple",children:"Customer Database"})]}),e.jsx("h1",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"Customer Management"}),e.jsx("p",{className:"text-slate-500 text-sm font-medium mt-1",children:"View, analyze, and manage customer accounts, orders, and loyalty tiers."})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-slate-900 text-white rounded-xl text-xs font-bold uppercase tracking-wider hover:bg-slate-800 transition-all shadow-md",children:[e.jsx(M,{size:16}),"Add New Customer"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:z.map((t,s)=>e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-gray-100 shadow-sm",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsx("div",{className:`p-2.5 rounded-xl ${t.bg} ${t.color}`,children:e.jsx(t.icon,{size:20})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900 tracking-tight",children:t.value}),e.jsx("p",{className:"text-[11px] font-bold uppercase tracking-wide text-gray-400 mt-1",children:t.label}),e.jsx("p",{className:`text-[10px] font-bold mt-1 ${t.color}`,children:t.sub})]})]},s))}),e.jsx("div",{className:"bg-white rounded-2xl p-3 shadow-sm border border-gray-100 sticky top-24 z-20",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative w-full md:w-96",children:[e.jsx(G,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{type:"text",placeholder:"Search Identity, Email, Phone...",value:m,onChange:t=>E(t.target.value),className:"w-full pl-10 pr-4 py-2.5 bg-gray-50 border-none rounded-xl text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-fario-purple/10 transition-all"})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full md:w-auto overflow-x-auto pb-2 md:pb-0 scrollbar-hide",children:[e.jsx("div",{className:"flex bg-gray-50 p-1 rounded-xl border border-gray-50",children:["All","Active","Inactive","Suspended"].map(t=>e.jsx("button",{onClick:()=>P(t),className:`px-4 py-2 rounded-lg text-[10px] font-bold uppercase tracking-wider transition-all whitespace-nowrap ${p===t?"bg-white text-slate-900 shadow-sm":"text-gray-400 hover:text-slate-600"}`,children:t},t))}),e.jsx("div",{className:"h-6 w-[1px] bg-gray-200 mx-1 hidden md:block"}),e.jsxs("button",{onClick:I,className:"px-4 py-2 bg-white border border-gray-200 text-slate-600 rounded-lg text-[10px] font-bold uppercase tracking-wider hover:bg-gray-50 transition-all flex items-center gap-2 whitespace-nowrap",children:[e.jsx(H,{size:14})," Export"]})]})]})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(y,{children:k.map(t=>e.jsx(u,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl border border-gray-100 p-4 hover:shadow-md transition-all group",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full lg:w-[25%]",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-slate-100 border border-white shadow-sm flex items-center justify-center text-sm font-black text-slate-500",children:t.name.substring(0,2).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold text-slate-900 group-hover:text-fario-purple transition-colors",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:"text-[10px] font-mono text-slate-400",children:t.id}),e.jsxs("span",{className:"text-[10px] text-slate-400",children:["• Joined ",t.joined]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1 w-full lg:w-[25%]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-medium text-slate-600",children:[e.jsx(S,{size:12,className:"text-slate-300"})," ",t.email]}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-medium text-slate-600",children:[e.jsx(A,{size:12,className:"text-slate-300"})," ",t.phone]})]}),e.jsxs("div",{className:"flex items-center gap-8 w-full lg:w-[25%]",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-wider",children:"Lifetime Val"}),e.jsxs("p",{className:"text-sm font-black text-slate-900",children:["₹",t.totalSpent.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[9px] font-bold text-slate-400 uppercase tracking-wider",children:"Orders"}),e.jsx("p",{className:"text-sm font-black text-slate-900",children:t.orders})]})]}),e.jsxs("div",{className:"flex items-center gap-4 w-full lg:w-[25%] justify-between lg:justify-end",children:[e.jsx("span",{className:`px-3 py-1 rounded-lg text-[9px] font-bold uppercase tracking-wider ${$(t.tier)}`,children:t.tier||"Standard"}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>g(t),className:"p-2 hover:bg-slate-50 rounded-lg text-slate-400 hover:text-fario-purple",children:e.jsx(J,{size:16})}),e.jsx("button",{onClick:()=>C(t.id),className:"p-2 hover:bg-rose-50 rounded-lg text-slate-400 hover:text-rose-500",children:e.jsx(W,{size:16})})]})]})]})},t.id))}),k.length===0&&e.jsx("div",{className:"py-20 text-center",children:e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"No customers found"})})]}),e.jsx(y,{children:L&&e.jsxs("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center p-6",children:[e.jsx(u,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>h(!1),className:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm"}),e.jsxs(u,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"relative w-full max-w-md bg-white rounded-2xl shadow-xl overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex justify-between items-center",children:[e.jsx("h2",{className:"text-sm font-bold text-slate-900 uppercase tracking-wider",children:"Add Customer"}),e.jsx("button",{onClick:()=>h(!1),className:"text-slate-400 hover:text-slate-900",children:e.jsx(_,{size:18})})]}),e.jsxs("form",{onSubmit:D,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Full Name"}),e.jsx("input",{required:!0,value:x.name,onChange:t=>j({...x,name:t.target.value}),className:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-xs font-bold outline-none focus:ring-2 focus:ring-fario-purple/10",placeholder:"Name"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:x.email,onChange:t=>j({...x,email:t.target.value}),className:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-xs font-bold outline-none focus:ring-2 focus:ring-fario-purple/10",placeholder:"Email"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Phone"}),e.jsx("input",{required:!0,value:x.phone,onChange:t=>j({...x,phone:t.target.value}),className:"w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-xs font-bold outline-none focus:ring-2 focus:ring-fario-purple/10",placeholder:"Phone"})]}),e.jsx("button",{type:"submit",disabled:N,className:"w-full py-3 bg-fario-dark text-white rounded-xl font-bold uppercase text-[10px] tracking-wider hover:bg-slate-800 transition-all mt-4",children:N?"Processing...":"Create Account"})]})]})]})}),e.jsx(y,{children:i&&e.jsxs("div",{className:"fixed inset-0 z-[3000] flex justify-end",children:[e.jsx(u,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>g(null),className:"absolute inset-0 bg-slate-900/20 backdrop-blur-sm"}),e.jsxs(u,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:30,stiffness:300},className:"relative w-full max-w-md h-full bg-white shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-slate-900",children:i.name}),e.jsx("p",{className:"text-xs font-medium text-slate-500",children:i.id})]}),e.jsx("button",{onClick:()=>g(null),className:"w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center text-slate-400 hover:text-slate-900",children:e.jsx(_,{size:16})})]}),e.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 border border-gray-100",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Lifetime Value"}),e.jsxs("p",{className:"text-xl font-black text-slate-900 mt-1",children:["₹",i.totalSpent.toLocaleString()]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-slate-50 border border-gray-100",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:"Total Orders"}),e.jsx("p",{className:"text-xl font-black text-slate-900 mt-1",children:i.orders})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold text-slate-900 uppercase tracking-wider mb-2",children:"Contact Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm font-medium text-slate-600",children:[e.jsx(S,{size:16,className:"text-slate-300"})," ",i.email]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm font-medium text-slate-600",children:[e.jsx(A,{size:16,className:"text-slate-300"})," ",i.phone]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-bold text-slate-900 uppercase tracking-wider mb-2",children:"Actions"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>T(i.id),className:"flex-1 py-3 border border-gray-200 rounded-xl text-xs font-bold text-slate-600 hover:bg-gray-50",children:i.status==="Suspended"?"Unsuspend":"Suspend"}),e.jsx("button",{onClick:()=>C(i.id),className:"flex-1 py-3 bg-rose-50 border border-rose-100 rounded-xl text-xs font-bold text-rose-600 hover:bg-rose-100",children:"Delete"})]})]})]})]})]})})]})};export{te as default};
