import{j as e}from"./framer-ClpLoJbl.js";import{r as i}from"./vendor-CSLgDR2_.js";const u=()=>{try{const n=Object.keys(localStorage).find(a=>a.startsWith("sb-")&&a.endsWith("-auth-token"));if(n){const a=JSON.parse(localStorage.getItem(n)||"{}");return(a==null?void 0:a.access_token)||""}}catch(n){console.error("Error parsing auth token",n)}return""},p="https://csyiiksxpmbehiiovlbg.supabase.co",h="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNzeWlpa3N4cG1iZWhpaW92bGJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNTE1MDgsImV4cCI6MjA4NjYyNzUwOH0.A1i9vqFwd_BsMwtod_uFyR-yJhHGW2Vu7PmacxGT6m4";function A(){const[n,a]=i.useState([]),[v,m]=i.useState(!0),[f,x]=i.useState(null),[g,j]=i.useState(!1),[s,c]=i.useState({code:"",discounttype:"percentage",discountvalue:"",minordervalue:"",maxdiscount:"",usagelimit:""}),l=async()=>{console.log("ðŸ” Fetching coupons via REST API..."),m(!0),x(null);const t=u();if(!t){x("No Auth Token Found! Please Login Again."),m(!1);return}try{const r=await fetch(`${p}/rest/v1/coupons?select=*&order=createdat.desc`,{method:"GET",headers:{apikey:h,Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error(`Fetch Failed: ${r.status} ${r.statusText}`);const o=await r.json();console.log("âœ… Coupons loaded:",o.length),a(o)}catch(r){console.error("âŒ Fetch error:",r),x(r.message)}finally{m(!1)}};i.useEffect(()=>{l()},[]);const y=async t=>{if(t.preventDefault(),!s.code.trim())return alert("Code required");const r=u();if(!r)return alert("Auth Error");try{const o={code:s.code.toUpperCase().trim(),discounttype:s.discounttype,discountvalue:parseFloat(s.discountvalue)||0,minordervalue:parseFloat(s.minordervalue)||0,maxdiscount:s.maxdiscount?parseFloat(s.maxdiscount):null,usagelimit:s.usagelimit?parseInt(s.usagelimit):null,isactive:!0,usedcount:0},d=await fetch(`${p}/rest/v1/coupons`,{method:"POST",headers:{apikey:h,Authorization:`Bearer ${r}`,"Content-Type":"application/json",Prefer:"return=representation"},body:JSON.stringify(o)});if(!d.ok){const C=await d.json();throw new Error(C.message||"Insert failed")}alert("âœ… Coupon Created!"),j(!1),c({code:"",discounttype:"percentage",discountvalue:"",minordervalue:"",maxdiscount:"",usagelimit:""}),l()}catch(o){alert("Error: "+o.message)}},b=async(t,r)=>{const o=u();try{if(!(await fetch(`${p}/rest/v1/coupons?id=eq.${t}`,{method:"PATCH",headers:{apikey:h,Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({isactive:!r})})).ok)throw new Error("Update failed");l()}catch(d){alert("Error: "+d.message)}},N=async t=>{if(!confirm("Delete this coupon?"))return;const r=u();try{if(!(await fetch(`${p}/rest/v1/coupons?id=eq.${t}`,{method:"DELETE",headers:{apikey:h,Authorization:`Bearer ${r}`,"Content-Type":"application/json"}})).ok)throw new Error("Delete failed");l()}catch(o){alert("Error: "+o.message)}};return v?e.jsx("div",{className:"p-12 text-center",children:"Loading via REST API..."}):f?e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"bg-red-100 p-4 rounded text-red-700",children:[e.jsx("strong",{children:"Error:"})," ",f,e.jsx("button",{onClick:l,className:"ml-4 underline",children:"Retry"})]})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"ðŸŽŸï¸ Coupons Management (Direct API)"}),e.jsx("button",{onClick:()=>j(!g),className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition",children:g?"Cancel":"+ Create Coupon"})]}),g&&e.jsxs("form",{onSubmit:y,className:"bg-white p-6 rounded-lg shadow mb-6 border-2 border-blue-500",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx("input",{placeholder:"Code (e.g. SAVE20)",value:s.code,onChange:t=>c({...s,code:t.target.value.toUpperCase()}),className:"border p-2 rounded",required:!0}),e.jsxs("select",{value:s.discounttype,onChange:t=>c({...s,discounttype:t.target.value}),className:"border p-2 rounded",children:[e.jsx("option",{value:"percentage",children:"Percentage %"}),e.jsx("option",{value:"fixed",children:"Fixed Amount â‚¹"})]}),e.jsx("input",{type:"number",placeholder:"Value (e.g. 20)",value:s.discountvalue,onChange:t=>c({...s,discountvalue:t.target.value}),className:"border p-2 rounded",required:!0}),e.jsx("input",{type:"number",placeholder:"Min Order Value",value:s.minordervalue,onChange:t=>c({...s,minordervalue:t.target.value}),className:"border p-2 rounded"})]}),e.jsx("button",{type:"submit",className:"mt-4 bg-green-600 text-white px-6 py-2 rounded",children:"Save Coupon"})]}),e.jsx("div",{className:"bg-white rounded-lg shadow",children:n.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No coupons found. API Connection Verified."}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left",children:"Code"}),e.jsx("th",{className:"p-3 text-left",children:"Discount"}),e.jsx("th",{className:"p-3 text-left",children:"Status"}),e.jsx("th",{className:"p-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:n.map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-3 font-bold",children:t.code}),e.jsxs("td",{className:"p-3",children:[t.discountvalue," ",t.discounttype==="percentage"?"%":"â‚¹"]}),e.jsx("td",{className:"p-3",children:t.isactive?e.jsx("span",{className:"text-green-600",children:"Active"}):e.jsx("span",{className:"text-red-500",children:"Inactive"})}),e.jsxs("td",{className:"p-3 space-x-2",children:[e.jsx("button",{onClick:()=>b(t.id,t.isactive),className:"text-blue-500",children:"Toggle"}),e.jsx("button",{onClick:()=>N(t.id),className:"text-red-500",children:"Delete"})]})]},t.id))})]})})]})}export{A as default};
